const sqlite = require('sqlite3')

const db = new sqlite.Database('coffee-house.db')

const createUserTable = `CREATE TABLE IF NOT EXISTS USER (ID INTEGER PRIMARY KEY AUTOINCREMENT,
NAME TEXT NOT NULL,
EMAIL TEXT UNIQUE NOT NULL,
PASSWORD TEXT NOT NULL,
ISADMIN INT)`

const createProductTable = `
    CREATE TABLE IF NOT EXISTS PRODUCT (
        ID INTEGER PRIMARY KEY AUTOINCREMENT,
        NAME TEXT NOT NULL,
        DESCRIPTION TEXT,
        PRICE REAL NOT NULL,
        STOCK INTEGER NOT NULL,
        IMAGE TEXT
    )
`;


const createCartTable = `
    CREATE TABLE IF NOT EXISTS CART (
        ID INTEGER PRIMARY KEY AUTOINCREMENT,
        USER_ID INTEGER NOT NULL,
        PRODUCT_ID INTEGER NOT NULL,
        QUANTITY INTEGER NOT NULL,
        FOREIGN KEY (USER_ID) REFERENCES USER(ID),
        FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(ID)
    )
`;

const createOrdersTable = `
    CREATE TABLE IF NOT EXISTS ORDERS (
        ID INTEGER PRIMARY KEY AUTOINCREMENT,
        USER_ID INTEGER NOT NULL,
        TOTAL_PRICE REAL NOT NULL,
        STATUS TEXT NOT NULL DEFAULT 'Pending',
        CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (USER_ID) REFERENCES USER(ID)
    )
`;

const createOrderItemsTable = `
    CREATE TABLE IF NOT EXISTS ORDER_ITEMS (
        ID INTEGER PRIMARY KEY AUTOINCREMENT,
        ORDER_ID INTEGER NOT NULL,
        PRODUCT_ID INTEGER NOT NULL,
        QUANTITY INTEGER NOT NULL,
        PRICE REAL NOT NULL,
        FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ID),
        FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(ID)
    )
`;


module.exports = { db, createUserTable, createProductTable, createCartTable, createOrdersTable, createOrderItemsTable }